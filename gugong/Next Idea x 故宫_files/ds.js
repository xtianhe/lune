(function(){var e="https:"==document.location.protocol?" https://":" http://";var n=e+"tongji.datastory.com.cn/";var t=60*30;var r="6d782e77-ab31-4f21-a2d1-370c4e780870";var o="";var a="82de4fc7-de71-4b3a-a4f6-ea3ed0c6e179";var i=(window.screen.width||0)+"x"+(window.screen.height||0);var d=(new Date).getTime();var s="";var c={};var l={};var u=function(){return parseInt(Math.random()*1e7)};var f=function(e){var n=/http[s]?:\/\/([^\/]+)\//i;var t=e.match(n);return t[1]};var m=function(e){if(!e)return"";if(e.indexOf("://")!=-1)e=e.substr(e.indexOf("://")+3);var n=["com","net","org","gov","edu","mil","biz","name","info","mobi","pro","travel","museum","int","areo","post","rec","im","cn","me"];var t=e.split(".");if(t.length<=1)return e;if(!isNaN(t[t.length-1]))return e;var r=".com.cn";if(e.indexOf(r)!=-1){return t[t.length-3]+"."+t[t.length-2]+"."+t[t.length-1]}var o=0;while(o<n.length&&n[o]!=t[t.length-1])o++;if(o!=n.length)return t[t.length-2]+"."+t[t.length-1];else{o=0;while(o<n.length&&n[o]!=t[t.length-2])o++;if(o==n.length)return t[t.length-2]+"."+t[t.length-1];else return t[t.length-3]+"."+t[t.length-2]+"."+t[t.length-1]}};var I=function(e){e=h(n+e,"rnd",u());var t=new Image;t.src=e};var v={add:function(e,t){var r=document.createElement("iframe");r.src=n+"set_cookie?dsId="+e;r.style.display="none";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(r,o);if(r.attachEvent){r.attachEvent("onload",function(){t&&t()})}else{r.onload=function(){t&&t()}}}};var p={get:function(e){var n=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));if(n!=null)return unescape(n[2]);return null},add:function(e,n,t){var r=e+"="+n;if(t!=0){var o=new Date;var a=t*1e3;o.setTime(o.getTime()+a);r+="; expires="+o.toGMTString()}var i=m(location.hostname);if(i!=""){r+="; domain="+i}r+=";path=/";document.cookie=r}};var g=function(){var e={setItem:function(e,n){p.add(e,n,t)},getItem:function(e){return p.get(e)},removeItem:function(e){p.add(e,"",-1)}};if(sessionStorage){try{var n=["REFER_DSCKID","REFER_DSTIMESTAMP","DS_FROM_TYPE"];var r=function(){if(document.referrer!=""){var e=m(f(document.referrer));var n=m(location.hostname);return e==n}else{return false}}();if(!r){for(var o=0;o<n.length;o++){e.removeItem(n[o])}}else{for(var o=0;o<n.length;o++){var a=sessionStorage.getItem(n[o]);var i=e.getItem(n[o]);if((a==null||a=="")&&(i!=null&&i!="")){sessionStorage.setItem(n[o],i)}}}}catch(d){}}return{setItem:function(n,t){sessionStorage&&sessionStorage.setItem(n,t);e.setItem(n,t)},getItem:function(n){if(sessionStorage){return sessionStorage.getItem(n)}else{return e.getItem(n)}}}}();var h=function(e,n,t){if(t==undefined||t==null){t=""}if(e.indexOf("?")!=-1||e.indexOf("=")!=-1){return e+"&"+n+"="+t}else{return e+"?"+n+"="+t}};var D=function(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)");var t=window.location.search.substr(1).match(n);if(t!=null)return unescape(t[2]);return null};var S=function(e){var n=e;try{var t="";if(e.indexOf("#")!=-1){t=e.split("#")[1];e=e.split("#")[0]}if(e.indexOf("DSCKID")!=-1){e=e.replace(/DSCKID=[a-zA-Z0-9-]{36}/,"DSCKID="+r)}else{e=h(e,"DSCKID",r)}if(e.indexOf("DSTIMESTAMP")!=-1){e=e.replace(/DSTIMESTAMP=[a-zA-Z0-9-]{13}/,"DSTIMESTAMP="+d)}else{e=h(e,"DSTIMESTAMP",d)}var o=g.getItem("DS_C_ID");if(o!=null){var a=o.indexOf("ds_sub_")==0?"":"ds_sub_";o=a+o;if(e.indexOf("dskid=")!=-1){e=e.replace(/dskid=[a-zA-Z0-9-_]{1,64}/,"dskid="+o)}else{e=h(e,"dskid",o)}}if(t!="")e+="#"+t;return e}catch(i){return n}};var _={sendVisit:function(){var e="visit.gif?url="+encodeURIComponent(location.href);e=h(e,"taskId",a);e=h(e,"referer",encodeURIComponent(document.referrer));e=h(e,"screen",i);var n=g.getItem("DS_FROM_TYPE");e=h(e,"fromType",n!=null?n:0);e=h(e,"dsId",r);e=h(e,"timestampId",d);e=h(e,"fromDsId",g.getItem("REFER_DSCKID"));e=h(e,"fromTimestamp",g.getItem("REFER_DSTIMESTAMP"));e=h(e,"channelId",g.getItem("DS_C_ID"));I(e)},sendRepost:function(e){var n="repost.gif?url="+encodeURIComponent(location.href);n=h(n,"taskId",a);n=h(n,"share",e);n=h(n,"dsId",r);n=h(n,"timestampId",d);n=h(n,"fromDsId",g.getItem("REFER_DSCKID"));n=h(n,"fromTimestamp",g.getItem("REFER_DSTIMESTAMP"));n=h(n,"channelId",g.getItem("DS_C_ID"));I(n)},sendAuthUserInfo:function(e,n){if(e==undefined||e==null)return;var t="authInfo.gif?url="+encodeURIComponent(location.href);try{t=h(t,"dsId",r);t=h(t,"openid",e.openid);t=h(t,"nickname",encodeURIComponent(encodeURIComponent(e.nickname)));t=h(t,"sex",e.sex);t=h(t,"province",encodeURIComponent(encodeURIComponent(e.province)));t=h(t,"city",encodeURIComponent(encodeURIComponent(e.city)));t=h(t,"country",encodeURIComponent(encodeURIComponent(e.country)));t=h(t,"headimgurl",e.headimgurl);t=h(t,"privilege",e.privilege?e.privilege.join(","):"");t=h(t,"unionid",e.unionid);t=h(t,"appid",n);t=h(t,"taskId",a);I(t)}catch(o){console.log(o);return}},sendBtnName:function(e){var n="button.gif?url="+encodeURIComponent(location.href);try{n=h(n,"taskId",a);n=h(n,"dsId",r);n=h(n,"timestampId",d);if(e.split(":")[0].match(/^page_.*_visit$/)){var t=e.split(":");c[t[0]]=t[1];return}else if(e.split(":")[0].match(/^page_.*_unload$/)){var t=e.split(":");var o=c[t[0].replace("unload","visit")];if(o!=undefined&&o!=null&&o<t[1]){var i=t[1]-o;n=h(n,"btnName",t[0].replace("unload","stay")+":"+i);c[t[0].replace("unload","visit")]=null}else{return}}else if(e.split(":")[0].match(/^(page_.*_load_start)|(home_page_load_start)$/)){var t=e.split(":");l[t[0]]=t[1];return}else if(e.split(":")[0].match(/^(page_.*_load_end)|(home_page_load_end)$/)){var t=e.split(":");var s=l[t[0].replace("end","start")];if(s!=undefined&&s!=null&&s<t[1]){var u=t[1]-s;n=h(n,"btnName",t[0].replace("_end","")+":"+u);l[t[0].replace("end","start")]=null}else{return}}else{n=h(n,"btnName",encodeURIComponent(e));n=h(n,"channelId",g.getItem("DS_C_ID"))}I(n)}catch(f){console.log(f);return}},sendPhoneNum:function(e){var n="phone.gif?url="+encodeURIComponent(location.href);try{n=h(n,"taskId",a);n=h(n,"dsId",r);n=h(n,"timestampId",d);n=h(n,"phoneNum",e);I(n)}catch(t){console.log(t);return}},sendUnload:function(){var e="unload.gif?url="+encodeURIComponent(location.href);try{e=h(e,"taskId",a);e=h(e,"dsId",r);e=h(e,"timestampId",d);I(e)}catch(n){console.log(n);return}}};var R={};R.event={};R.event.add=function(e,n,t){if(e.addEventListener){e.addEventListener(n,t,false)}else{}};if(window.DS==undefined)window.DS={};DS.linkChange=function(e){try{return S(e)}catch(n){}};DS.sendRepost=function(e){try{_.sendRepost(e)}catch(n){}};DS.sendAuthUserInfo=function(e,n){try{_.sendAuthUserInfo(e,n)}catch(t){}};DS.sendBtnName=function(e){try{_.sendBtnName(e)}catch(n){}};DS.sendPhoneNum=function(e){try{_.sendPhoneNum(e)}catch(n){}};var E=function(){try{var e=location.href;if(e.indexOf("DSCKID")!=-1){var n=D("DSCKID");var t=D("DSTIMESTAMP");g.setItem("REFER_DSCKID",n);g.setItem("REFER_DSTIMESTAMP",t)}if(e.indexOf("from")!=-1){var r=D("from");var o={singlemessage:1,groupmessage:2,timeline:3};if(o[r]==undefined){g.setItem("DS_FROM_TYPE",0)}else{g.setItem("DS_FROM_TYPE",o[r])}}if(e.indexOf("dskid=")!=-1){var a=D("dskid");g.setItem("DS_C_ID",a)}var i=document.referrer;if(i.indexOf("mp.weixin.qq.com")!=-1||i.indexOf("mp.weixinbridge.com")!=-1){g.setItem("DS_FROM_TYPE",4)}}catch(d){}};var C=function(){try{if(o==1){v.add(r)}E();_.sendVisit();R.event.add(window,"unload",function(){_.sendUnload()})}catch(e){}};C()})();